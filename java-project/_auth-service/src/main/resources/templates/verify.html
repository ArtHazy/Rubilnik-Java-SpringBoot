<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è - Rubilnik</title>
    <link href="https://fonts.googleapis.com/css2?family=Russo+One&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Russo One';
        }
        
        body {
            height: 100vh;
            background: #242424;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            color: #D9D9D9;
            overflow: hidden;
            position: relative;
        }

        body::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image:
            linear-gradient(to right, rgba(0,0,0,0.03) 10px, transparent 10px),
            linear-gradient(to bottom, rgba(0,0,0,0.03) 10px, transparent 10px);
            background-size: 20px 20px;
            background-blend-mode: multiply;
            mix-blend-mode: overlay;
            pointer-events: none;
            /* z-index: 1; */
        }
        
        .container {
            width: 100%;
            max-width: 600px;
            background: #242424;
            border-radius: 12px;
            overflow: hidden;
            position: relative;
            z-index: 10;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        }
        
        .header {
            background: #709B95;
            padding: 20px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 200%;
            height: 100%;
            background: linear-gradient(
                90deg,
                transparent,
                rgba(255, 255, 255, 0.2),
                transparent
            );
            animation: shine 3s infinite;
        }
        
        .header h1 {
            font-size: 2.2rem;
            font-weight: 400;
            letter-spacing: 1px;
            position: relative;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }
        
        .message-container {
            padding: 40px 30px;
            text-align: center;
            position: relative;
        }
        
        .message {
            font-size: 1.4rem;
            line-height: 1.6;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(40, 40, 40, 0.7);
            color: #d9d9d9;
            border-radius: 8px;
            position: relative;
            overflow: hidden;
            animation: 
                slideIn 0.5s ease-out forwards;
        }
        
        .success {
            border-left: 4px solid #3B765A;
            background: rgba(59, 118, 90, 0.1);
        }
        
        .warning {
            border-left: 4px solid #D6BF81;
            background: rgba(214, 191, 129, 0.1);
        }
        
        .error {
            border-left: 4px solid #B83B5E;
            background: rgba(184, 59, 94, 0.1);
        }
        
        .timer {
            font-size: 1.2rem;
            margin-top: 20px;
            color: #525252;
        }
        
        .link {
            display: inline-block;
            margin-top: 20px;
            padding: 12px 30px;
            background: transparent;
            color: #d6bf81;
            text-decoration: none;
            border-radius: 8px;
            font-weight: 400;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
            position: relative;
            overflow: hidden;
            z-index: 1;
            
            outline: 2px solid #d6bf81;
            outline-offset: -2px;
            transition: 
                outline-width 0.3s,
                outline-offset 0.3s;
        }
        
        .link:hover {
            outline-offset: -4px;
            outline-width: 3px;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.5);
            background: rgba(112, 155, 149, 0.1);
        }
        
        .footer {
            text-align: center;
            padding: 20px;
            background: rgba(20, 20, 20, 0.8);
            font-size: 0.9rem;
            color: #727272;
            border-top: 1px solid #525252;
        }
        
        .logo {
            font-size: 1.8rem;
            font-weight: 400;
            margin-bottom: 5px;
            text-transform: uppercase;
            letter-spacing: 2px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .logo-part-1 {
            color: #0FD4CD;
        }
        
        .logo-part-2 {
            color: #d6bf81;
        }
        
        .progress-bar {
            height: 6px;
            background: #525252;
            border-radius: 3px;
            margin-top: 20px;
            overflow: hidden;
            will-change: width; /* –ü–æ–¥—Å–∫–∞–∑–∫–∞ –±—Ä–∞—É–∑–µ—Ä—É –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ */
            transform: translateZ(0); /* –ê–ø–ø–∞—Ä–∞—Ç–Ω–æ–µ —É—Å–∫–æ—Ä–µ–Ω–∏–µ */
        }
        
        .progress {
            height: 100%;
            background: #709B95; 
            border-radius: 3px;
            width: 100%;
            transition: width 1s linear;
        }
        
        .status-icon {
            font-size: 3rem;
            margin-bottom: 20px;
            animation: float 3s ease-in-out infinite;
        }
        
        @keyframes shine {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
        
        @keyframes slideIn {
            from { 
                transform: translateY(20px); 
                opacity: 0;
            }
            to { 
                transform: translateY(0); 
                opacity: 1;
            }
        }
        
        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0px); }
        }
        
        @media (max-width: 480px) {
            .message {
                font-size: 1.2rem;
                padding: 15px;
            }
            
            .header h1 {
                font-size: 1.8rem;
            }
            
            .link {
                padding: 10px 20px;
                font-size: 1rem;
            }
            
            .status-icon {
                font-size: 2.5rem;
            }
        }
    </style>
</head>
<body>    
    <div class="container">
        <div class="header">
            <h1>–í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è –∞–∫–∫–∞—É–Ω—Ç–∞</h1>
        </div>
        
        <div class="message-container">
            <div class="status-icon">üîí</div>
            
            <div class="message" id="messageDisplay">
                –ò–¥–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–∫–µ–Ω–∞ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏...
            </div>
            
            <div class="timer" id="timer">
                –û–∂–∏–¥–∞–Ω–∏–µ: <span id="countdown">3</span> —Å–µ–∫
            </div>

            <div class="progress-bar">
                <div class="progress" id="progressBar"></div>
            </div>
            
            <a th:href="${link}" href="http://rubilnik.ddns.net/login" class="link" id="actionLink" style="display: none;">
                –ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤—Ö–æ–¥–∞
            </a>
        </div>
        
        <div class="footer">
            <div class="logo">
                <span class="logo-part-1">–†–£–ë–ò–õ–¨</span><span class="logo-part-2">–ù–ò–ö</span>
            </div>
        </div>
    </div>
    
    <script>
        // –≠–ª–µ–º–µ–Ω—Ç—ã —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        const messageDisplay = document.getElementById('messageDisplay');
        const countdownElement = document.getElementById('countdown');
        const progressBar = document.getElementById('progressBar');
        const timerElement = document.getElementById('timer');
        const actionLink = document.getElementById('actionLink');
        const statusIcon = document.querySelector('.status-icon');

        let serverLink

        <!-- comment for raw html preview -->
        const status = [[${status}]];
        const msg = [[${message}]];
        serverLink = [[${link}]];
        <!--  -->

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏—è –∏ –ø–æ–≤–µ–¥–µ–Ω–∏—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        function updatePage(message, status) {
            // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è
            messageDisplay.textContent = message;
            
            // –£–¥–∞–ª—è–µ–º –≤—Å–µ –ø—Ä–µ–¥—ã–¥—É—â–∏–µ –∫–ª–∞—Å—Å—ã
            messageDisplay.className = 'message';
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π —Å—Ç–∏–ª—å
            if (status === 'success') {
                messageDisplay.classList.add('success');
                timerElement.textContent = '–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑: ';
                actionLink.style.display = 'inline-block';
                statusIcon.textContent = '‚úÖ';
                statusIcon.style.color = '#3B765A';
            } else if (status === 'error') {
                messageDisplay.classList.add('error');
                timerElement.textContent = '–û–∫–Ω–æ –∑–∞–∫—Ä–æ–µ—Ç—Å—è —á–µ—Ä–µ–∑: ';
                actionLink.style.display = 'none';
                statusIcon.textContent = '‚ùå';
                statusIcon.style.color = '#B83B5E';
            } else {
                messageDisplay.classList.add('warning');
                timerElement.textContent = '–û–∫–Ω–æ –∑–∞–∫—Ä–æ–µ—Ç—Å—è —á–µ—Ä–µ–∑: ';
                actionLink.style.display = 'none';
                statusIcon.textContent = '‚ö†Ô∏è';
                statusIcon.style.color = '#D6BF81';
            }
            
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ç–∞–π–º–µ—Ä
            resetTimer(status);
        }
        
        // –¢–∞–π–º–µ—Ä
        let countdown;
        let secondsLeft;
        
        function resetTimer(status) {
            clearInterval(countdown);
            
            secondsLeft = status === 'success' ? 3 : 5;
            countdownElement.textContent = secondsLeft;
            
            countdown = setInterval(() => {
                secondsLeft--;
                countdownElement.textContent = secondsLeft;
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä
                const percent = (secondsLeft / (status === 'success' ? 3 : 5)) * 100;
                progressBar.style.width = percent + '%';
                
                if (secondsLeft < 0) {
                    clearInterval(countdown);


                    if (status === 'success') {
                        // –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤—Ö–æ–¥–∞
                        window.location.href = serverLink || 'http://rubilnik.ddns.net/login';
                    } else {
                        // –ó–∞–∫—Ä—ã—Ç–∏–µ –æ–∫–Ω–∞
                        timerElement.textContent = '–ó–∞–∫—Ä—ã—Ç–∏–µ –æ–∫–Ω–∞...';
                        setTimeout(() => {
                            // –ü—ã—Ç–∞–µ–º—Å—è –∑–∞–∫—Ä—ã—Ç—å –æ–∫–Ω–æ
                            try {
                                window.close();
                            } catch (e) {
                                // –ï—Å–ª–∏ –Ω–µ –ø–æ–ª—É—á–∏–ª–æ—Å—å, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
                                document.querySelector('.container').innerHTML = `
                                    <div style="padding: 50px; text-align: center;">
                                        <div class="message warning" style="margin-bottom: 20px;">
                                            –≠—Ç–æ –æ–∫–Ω–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –∑–∞–∫—Ä—ã—Ç–æ —Ç–æ–ª—å–∫–æ –≤—Ä—É—á–Ω—É—é
                                        </div>
                                        <div class="timer">–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–∫—Ä–æ–π—Ç–µ —ç—Ç—É –≤–∫–ª–∞–¥–∫—É</div>
                                    </div>
                                `;
                            }
                        }, 1000);
                    }
                }
            }, 1000);
        }
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏
        window.addEventListener('load', function() {
            // –ü—ã—Ç–∞–µ–º—Å—è –ø–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç—É—Å –∏–∑ URL
            const urlParams = new URLSearchParams(window.location.search);



            let message, statusType;

            message = "–ò–¥–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–∫–µ–Ω–∞ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏...";
            statusType = 'warning';

            setTimeout(() => {
                if (status === 'success') {
                    statusType = 'success';
                    updatePage(msg, status);
                } else if (status === 'error') {
                    statusType = 'error';
                    updatePage(msg, status);
                } else if (status === 'warning') {
                    statusType = 'warning';
                    updatePage(msg, status);
                } else { // preview
                    statusType = 'success';
                    updatePage("–£—Å–ø–µ—à–Ω–æ! –í–∞—à –∞–∫–∫–∞—É–Ω—Ç –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω", 'success');
                }
            }, 2000);

            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É —Å –Ω–æ–≤—ã–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º
            updatePage(message, statusType);
        });
    </script>
</body>
</html>